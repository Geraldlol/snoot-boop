<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snoot Booper: Idle Wuxia Cat Sanctuary</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <!-- Modular CSS Architecture -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/screens.css">
  <link rel="stylesheet" href="css/features.css">
  <link rel="stylesheet" href="css/modals.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
  <div id="game-container">
    <!-- Master Select Screen -->
    <div id="master-select-screen" class="screen active">
      <div class="scroll-panel title-panel">
        <h1 class="game-title">Snoot Booper</h1>
        <p class="game-subtitle">Idle Wuxia Cat Sanctuary</p>
      </div>

      <p class="choose-text">Choose Your Path, Young Cultivator</p>

      <div id="masters-grid" class="masters-grid">
        <!-- Fallback master cards - JS will replace these if it loads successfully -->
        <div class="master-card" data-master="gerald" onclick="window.showMasterPreview && window.showMasterPreview('gerald')" style="--master-color: #50C878; cursor: pointer;">
          <div class="master-portrait">ğŸ‰</div>
          <h3>Gerald</h3>
          <p class="title">The Jade Palm</p>
        </div>
        <div class="master-card" data-master="rusty" onclick="window.showMasterPreview && window.showMasterPreview('rusty')" style="--master-color: #DC143C; cursor: pointer;">
          <div class="master-portrait">ğŸ‘Š</div>
          <h3>Rusty</h3>
          <p class="title">The Crimson Fist</p>
        </div>
        <div class="master-card" data-master="steve" onclick="window.showMasterPreview && window.showMasterPreview('steve')" style="--master-color: #4169E1; cursor: pointer;">
          <div class="master-portrait">ğŸŒŠ</div>
          <h3>Steve</h3>
          <p class="title">The Flowing River</p>
        </div>
        <div class="master-card" data-master="andrew" onclick="window.showMasterPreview && window.showMasterPreview('andrew')" style="--master-color: #FFD700; cursor: pointer;">
          <div class="master-portrait">âš¡</div>
          <h3>Andrew</h3>
          <p class="title">The Thunder Step</p>
        </div>
        <div class="master-card" data-master="nik" onclick="window.showMasterPreview && window.showMasterPreview('nik')" style="--master-color: #483D8B; cursor: pointer;">
          <div class="master-portrait">ğŸŒ™</div>
          <h3>Nik</h3>
          <p class="title">The Shadow Moon</p>
        </div>
        <div class="master-card" data-master="yuelin" onclick="window.showMasterPreview && window.showMasterPreview('yuelin')" style="--master-color: #FFB6C1; cursor: pointer;">
          <div class="master-portrait">ğŸª·</div>
          <h3>Yuelin</h3>
          <p class="title">The Lotus Sage</p>
        </div>
        <div class="master-card" data-master="scott" onclick="window.showMasterPreview && window.showMasterPreview('scott')" style="--master-color: #8B4513; cursor: pointer;">
          <div class="master-portrait">â›°ï¸</div>
          <h3>Scott</h3>
          <p class="title">The Mountain</p>
        </div>
      </div>

      <div id="master-preview" class="scroll-panel master-preview hidden">
        <div class="preview-header">
          <div class="preview-portrait-container">
            <div id="preview-portrait" class="preview-portrait"></div>
          </div>
          <div class="preview-info">
            <h2 id="preview-name"></h2>
            <p id="preview-title" class="preview-title"></p>
            <p id="preview-role" class="preview-role"></p>
          </div>
        </div>
        <p id="preview-description" class="preview-description"></p>
        <div class="preview-passive">
          <span class="passive-label">Passive Ability:</span>
          <span id="preview-passive-name" class="passive-name"></span>
          <p id="preview-passive-desc" class="passive-desc"></p>
        </div>
        <button id="select-master-btn" class="jade-button">Begin Cultivation</button>
      </div>
    </div>

    <!-- Main Game Screen -->
    <div id="game-screen" class="screen">
      <!-- Header with resources - 9 Currency Economy -->
      <header class="game-header" role="banner">
        <div class="resource-bar" role="status" aria-live="polite">
          <!-- Primary Currencies -->
          <div class="resource" title="Boop Points - Earned from booping">
            <span class="resource-icon">ğŸ‘†</span>
            <span class="resource-label" id="bp-label">BP</span>
            <span id="bp-display" class="resource-value" aria-labelledby="bp-label">0</span>
          </div>
          <div class="resource pp-resource" id="pp-resource-container" title="Purr Power - Passive generation from cats">
            <span class="resource-icon">ğŸ˜º</span>
            <span class="resource-label" id="pp-label">PP</span>
            <span id="pp-display" class="resource-value" aria-labelledby="pp-label">0</span>
            <span id="pp-rate" class="resource-rate"></span>
            <div id="pp-breakdown" class="pp-breakdown hidden">
              <h4>PP Generation Breakdown</h4>
              <div id="pp-breakdown-content"></div>
            </div>
          </div>
          <div class="resource" title="Qi Energy - Used for techniques and breakthroughs">
            <span class="resource-icon">âœ¨</span>
            <span class="resource-label" id="qi-label">Qi</span>
            <span id="qi-display" class="resource-value qi-value" aria-labelledby="qi-label">0</span>
          </div>
          <div class="resource" title="Jade Catnip - Premium currency for rare items">
            <span class="resource-icon">ğŸ’</span>
            <span class="resource-label" id="jc-label">JC</span>
            <span id="jc-display" class="resource-value jade-value" aria-labelledby="jc-label">0</span>
          </div>
          <!-- Secondary Currencies (collapsible) -->
          <div class="resource-expander" id="resource-expander" onclick="toggleCurrencyPanel()">
            <span>+5</span>
          </div>
          <div class="resource" title="Cats in your sanctuary">
            <span class="resource-icon">ğŸ±</span>
            <span class="resource-label" id="cats-label">Cats</span>
            <span id="cat-count-display" class="resource-value" aria-labelledby="cats-label">0</span>
          </div>
        </div>

        <!-- Extended Currency Panel (hidden by default) -->
        <div id="currency-panel" class="currency-panel hidden">
          <div class="currency-grid">
            <div class="currency-item" title="Spirit Stones - Equipment enhancement">
              <span class="currency-icon">ğŸ’ </span>
              <span class="currency-name">Spirit Stones</span>
              <span id="spirit-stones-display" class="currency-value">0</span>
            </div>
            <div class="currency-item" title="Heavenly Seals - Prestige currency">
              <span class="currency-icon">ğŸ”®</span>
              <span class="currency-name">Heavenly Seals</span>
              <span id="heavenly-seals-display" class="currency-value">0</span>
            </div>
            <div class="currency-item" title="Sect Reputation - Social features">
              <span class="currency-icon">ğŸ†</span>
              <span class="currency-name">Sect Rep</span>
              <span id="sect-rep-display" class="currency-value">0</span>
            </div>
            <div class="currency-item" title="Waifu Tokens - Bond activities">
              <span class="currency-icon">ğŸ’•</span>
              <span class="currency-name">Waifu Tokens</span>
              <span id="waifu-tokens-display" class="currency-value">0</span>
            </div>
            <div class="currency-item" title="Goose Feathers - Goose shop">
              <span class="currency-icon">ğŸª¶</span>
              <span class="currency-name">Goose Feathers</span>
              <span id="goose-feathers-display" class="currency-value">0</span>
            </div>
          </div>
        </div>
        <div class="header-right">
          <div id="combo-display" class="combo-display hidden" role="status" aria-live="polite">
            <span id="combo-count">0</span>x COMBO
          </div>
          <button id="open-social-btn" class="open-social-btn" aria-label="Social features" title="Social">
            <span>ğŸ†</span>
            <span>Sect</span>
          </button>
          <button id="help-btn" class="header-btn" aria-label="Help and tutorial" title="Help">â“</button>
          <button id="settings-btn" class="header-btn" aria-label="Settings" title="Settings">âš™ï¸</button>
          <div id="master-badge" class="master-badge">
            <span id="current-master-name"></span>
          </div>
        </div>
      </header>

      <!-- Main game layout -->
      <div class="game-layout">
        <!-- Left Panel: Waifu -->
        <aside class="side-panel waifu-panel">
          <div class="panel-header">
            <span id="waifu-emoji" class="panel-icon">ğŸ¡</span>
            <span class="panel-title">Master</span>
          </div>
          <div class="waifu-portrait-container">
            <div id="waifu-portrait" class="waifu-portrait">ğŸ¡</div>
          </div>
          <div class="waifu-info">
            <h3 id="waifu-name">Mochi-chan</h3>
            <p id="waifu-title" class="waifu-title">The Welcoming Dawn</p>
            <div class="bond-bar">
              <div id="bond-fill" class="bond-fill" style="width: 0%"></div>
            </div>
            <p class="bond-label">Bond: <span id="bond-level">0</span>/100</p>
          </div>
          <div id="waifu-dialogue" class="waifu-dialogue">
            "Welcome to the teahouse~"
          </div>
          <div class="waifu-bonus">
            <span id="waifu-bonus-text">+10% BP</span>
          </div>
        </aside>

        <!-- Center: Boop Area (at top of center column) -->
        <main class="game-main" role="main">
          <div class="boop-area">
            <div id="active-cat-display" class="active-cat-display">
              <div id="active-cat" class="active-cat" role="img" aria-label="Current cat">ğŸ±</div>
              <p id="active-cat-name" class="active-cat-name">Recruit a cat!</p>
            </div>
            <button id="boop-button" class="boop-button" aria-label="Boop the cat's snoot to earn Boop Points">
              BOOP<br>THE<br>SNOOT
            </button>
            <p id="boop-power-display" class="boop-power-display" aria-live="polite">+1 BP per boop</p>
          </div>
          <div id="floating-text-container" class="floating-text-container" aria-hidden="true"></div>
        </main>

        <!-- Cultivation Realm Display (Expanded 10-Realm System) -->
        <div id="cultivation-display" class="cultivation-display">
          <div class="cultivation-header">
            <span class="cultivation-icon">â˜¯ï¸</span>
            <span class="cultivation-title">Cultivation</span>
            <div id="time-season-indicator" class="time-season-indicator">
              <span id="time-of-day-icon" class="time-icon">â˜€ï¸</span>
              <span id="season-icon" class="season-icon">ğŸŒ¸</span>
            </div>
          </div>
          <div class="cultivation-realm-info">
            <h3 id="cultivation-realm-name" class="realm-name">Mortal Realm</h3>
            <p id="cultivation-rank" class="realm-rank">Rank 1/9</p>
            <p id="cultivation-order" class="realm-order">Realm 1 of 10</p>
          </div>
          <div class="cultivation-xp-bar">
            <div id="cultivation-xp-fill" class="xp-fill" style="width: 0%"></div>
            <span id="cultivation-xp-text" class="xp-text">0 / 100 XP</span>
          </div>
          <div class="cultivation-description">
            <p id="cultivation-desc">The beginning of the path.</p>
          </div>

          <!-- Tribulation Warning -->
          <div id="tribulation-warning" class="tribulation-warning hidden">
            <span class="tribulation-icon">âš¡</span>
            <span id="tribulation-name">Tribulation Available</span>
          </div>

          <div id="cultivation-passives" class="cultivation-passives">
            <!-- Unlocked passives will be listed here -->
          </div>

          <div class="cultivation-actions">
            <button id="breakthrough-btn" class="jade-button small breakthrough-btn hidden" onclick="attemptBreakthrough()">
              âš¡ Attempt Breakthrough
            </button>
            <button id="tribulation-btn" class="jade-button small tribulation-btn hidden" onclick="startTribulation()">
              ğŸ”¥ Face Tribulation
            </button>
          </div>
        </div>

        <!-- Technique Stance Panel -->
        <div id="stance-display" class="stance-display">
          <div class="stance-header">
            <span class="stance-icon">ğŸ¥‹</span>
            <span class="stance-title">Technique Stance</span>
          </div>
          <div class="current-stance">
            <span id="current-stance-name" class="stance-name">Jade Palm</span>
            <span id="current-stance-level" class="stance-mastery">Mastery: 0/10</span>
          </div>
          <div class="stance-mastery-bar">
            <div id="stance-mastery-fill" class="mastery-fill" style="width: 0%"></div>
          </div>
          <div class="stance-selector">
            <button class="stance-btn active" data-stance="jadePalm" title="Jade Palm - Balanced">ğŸ–ï¸</button>
            <button class="stance-btn locked" data-stance="ironFinger" title="Iron Finger - Power (Qi Condensation)">ğŸ‘†</button>
            <button class="stance-btn locked" data-stance="drunkenPaw" title="Drunken Paw - Random (Foundation)">ğŸº</button>
            <button class="stance-btn locked" data-stance="shadowStep" title="Shadow Step - Speed (Core Formation)">ğŸ‘¤</button>
            <button class="stance-btn locked" data-stance="flowingRiver" title="Flowing River - AFK (Nascent Soul)">ğŸŒŠ</button>
            <button class="stance-btn locked" data-stance="forbiddenTechnique" title="Forbidden - Ultimate (Spirit Severing)">ğŸ’€</button>
          </div>
          <div id="stance-special" class="stance-special hidden">
            <span id="stance-special-name">Special: None</span>
          </div>
        </div>

        <!-- Waifu Harmony Indicator -->
        <div id="harmony-indicator" class="harmony-indicator">
          <div class="harmony-header">
            <span class="harmony-icon">ğŸ’•</span>
            <span class="harmony-title">Waifu Harmony</span>
          </div>
          <div class="harmony-status">
            <span id="harmony-status-text" class="harmony-text">Balanced</span>
            <span id="harmony-emoji" class="harmony-emoji">â˜¯ï¸</span>
          </div>
          <div class="harmony-bar">
            <div id="harmony-fill" class="harmony-fill" style="width: 50%"></div>
          </div>
          <div id="jealousy-alert" class="jealousy-alert hidden">
            <span id="jealous-waifu-name">Someone</span> seems jealous...
          </div>
        </div>

        <!-- Right Panel: Tabs -->
        <aside class="side-panel right-panel">
          <!-- Tab Navigation -->
          <div class="tab-bar">
            <button class="tab-btn active" data-tab="cats">ğŸ± Cats</button>
            <button class="tab-btn" data-tab="teams">ğŸ‘¥ Teams</button>
            <button class="tab-btn" data-tab="upgrades">âš”ï¸ Arts</button>
            <button class="tab-btn" data-tab="dungeons">ğŸ¯ Dungeons</button>
            <button class="tab-btn" data-tab="equipment">âš™ï¸ Equip</button>
            <button class="tab-btn" data-tab="forge">ğŸ”¨ Forge</button>
            <button class="tab-btn" data-tab="expeditions">ğŸ—ºï¸ Quest</button>
            <button class="tab-btn" data-tab="catino">ğŸ° Casino</button>
            <button class="tab-btn" data-tab="partners">ğŸ’• Partners</button>
            <button class="tab-btn" data-tab="buildings">ğŸ—ï¸ Build</button>
            <button class="tab-btn" data-tab="prestige">ğŸŒŸ Ascend</button>
            <button class="tab-btn" data-tab="techniques">ğŸ“œ Skills</button>
            <button class="tab-btn" data-tab="relics">ğŸº Relics</button>
            <button class="tab-btn" data-tab="codex">ğŸ“– Codex</button>
            <button class="tab-btn" data-tab="shop">ğŸ¦… Shop</button>
            <button class="tab-btn" data-tab="stats">ğŸ“Š Stats</button>
          </div>

          <!-- Cats Tab -->
          <div id="cats-tab" class="tab-content active">
            <div class="recruit-section">
              <button id="recruit-btn" class="recruit-button">
                <span class="recruit-text">Recruit Cat</span>
                <span id="recruit-cost" class="recruit-cost">100 BP</span>
              </button>
              <div class="cat-capacity-display">
                <span class="capacity-label">Sect Capacity:</span>
                <span id="cat-capacity-current">0</span>/<span id="cat-capacity-max">10</span>
              </div>
            </div>
            <!-- Cat Filters -->
            <div class="cat-filters">
              <select id="cat-filter-element" class="cat-filter-select">
                <option value="all">All Elements</option>
                <option value="metal">ğŸª™ Metal</option>
                <option value="wood">ğŸŒ¿ Wood</option>
                <option value="water">ğŸ’§ Water</option>
                <option value="fire">ğŸ”¥ Fire</option>
                <option value="earth">ğŸª¨ Earth</option>
                <option value="void">ğŸŒ‘ Void</option>
                <option value="chaos">ğŸŒ€ Chaos</option>
              </select>
              <select id="cat-filter-realm" class="cat-filter-select">
                <option value="all">All Realms</option>
                <option value="kittenMortal">Mortal Kitten</option>
                <option value="earthKitten">Earth Kitten</option>
                <option value="skyKitten">Sky Kitten</option>
                <option value="heavenKitten">Heaven Kitten</option>
                <option value="divineBeast">Divine Beast</option>
              </select>
              <select id="cat-sort" class="cat-filter-select">
                <option value="recent">Sort: Recent</option>
                <option value="realm">Sort: Realm</option>
                <option value="stars">Sort: Stars</option>
                <option value="happiness">Sort: Happiness</option>
              </select>
            </div>
            <div id="cat-collection" class="cat-collection">
              <p class="empty-message">No cats yet. Recruit your first disciple!</p>
            </div>
          </div>

          <!-- Cat Teams Tab -->
          <div id="teams-tab" class="tab-content">
            <div class="teams-panel">
              <h4 class="category-header">ğŸ‘¥ Cat Teams & Formations</h4>
              <p class="teams-info">Form a team of 4 cats + 1 reserve for dungeons!</p>

              <!-- Current Team Display -->
              <div class="team-builder">
                <h5 class="team-section-header">Active Team</h5>
                <div class="team-slots">
                  <div class="team-slot" data-slot="0" data-position="front">
                    <span class="slot-position">Front</span>
                    <div class="slot-cat empty">+</div>
                    <span class="slot-label">Slot 1</span>
                  </div>
                  <div class="team-slot" data-slot="1" data-position="front">
                    <span class="slot-position">Front</span>
                    <div class="slot-cat empty">+</div>
                    <span class="slot-label">Slot 2</span>
                  </div>
                  <div class="team-slot" data-slot="2" data-position="back">
                    <span class="slot-position">Back</span>
                    <div class="slot-cat empty">+</div>
                    <span class="slot-label">Slot 3</span>
                  </div>
                  <div class="team-slot" data-slot="3" data-position="back">
                    <span class="slot-position">Back</span>
                    <div class="slot-cat empty">+</div>
                    <span class="slot-label">Slot 4</span>
                  </div>
                  <div class="team-slot reserve" data-slot="reserve">
                    <span class="slot-position">Reserve</span>
                    <div class="slot-cat empty">+</div>
                    <span class="slot-label">Backup</span>
                  </div>
                </div>
              </div>

              <!-- Formation Selector -->
              <div class="formation-selector">
                <h5 class="team-section-header">Formation</h5>
                <div class="formation-options">
                  <button class="formation-btn active" data-formation="default" title="Standard Formation">
                    <span class="formation-icon">â¬œâ¬œ<br>â¬œâ¬œ</span>
                    <span class="formation-name">Standard</span>
                  </button>
                  <button class="formation-btn" data-formation="aggressive" title="Aggressive - +20% ATK, -10% DEF">
                    <span class="formation-icon">â¬œâ¬œâ¬œ<br>â¬œ</span>
                    <span class="formation-name">Aggressive</span>
                  </button>
                  <button class="formation-btn" data-formation="defensive" title="Defensive - -10% ATK, +30% DEF">
                    <span class="formation-icon">â¬œ<br>â¬œâ¬œâ¬œ</span>
                    <span class="formation-name">Defensive</span>
                  </button>
                  <button class="formation-btn" data-formation="balanced" title="Balanced - +10% both">
                    <span class="formation-icon">â¬œ<br>â¬œâ¬œ<br>â¬œ</span>
                    <span class="formation-name">Balanced</span>
                  </button>
                </div>
              </div>

              <!-- Team Synergies -->
              <div class="team-synergies">
                <h5 class="team-section-header">Active Synergies</h5>
                <div id="synergy-list" class="synergy-list">
                  <p class="empty-message">Add cats to see synergies!</p>
                </div>
              </div>

              <!-- Elemental Resonance -->
              <div class="elemental-resonance">
                <h5 class="team-section-header">Elemental Resonance</h5>
                <div id="resonance-display" class="resonance-display">
                  <span class="resonance-bonus">1.0x</span>
                  <span class="resonance-label">Team Power</span>
                </div>
              </div>

              <!-- Team Stats Summary -->
              <div class="team-stats-summary">
                <h5 class="team-section-header">Team Stats</h5>
                <div class="team-stats-grid">
                  <div class="team-stat">
                    <span class="stat-icon">âš”ï¸</span>
                    <span id="team-attack" class="stat-value">0</span>
                    <span class="stat-label">Attack</span>
                  </div>
                  <div class="team-stat">
                    <span class="stat-icon">ğŸ›¡ï¸</span>
                    <span id="team-defense" class="stat-value">0</span>
                    <span class="stat-label">Defense</span>
                  </div>
                  <div class="team-stat">
                    <span class="stat-icon">â¤ï¸</span>
                    <span id="team-hp" class="stat-value">0</span>
                    <span class="stat-label">HP</span>
                  </div>
                  <div class="team-stat">
                    <span class="stat-icon">ğŸ’¨</span>
                    <span id="team-speed" class="stat-value">0</span>
                    <span class="stat-label">Speed</span>
                  </div>
                </div>
              </div>

              <!-- Cat Fusion -->
              <div class="cat-fusion-section">
                <h5 class="team-section-header">ğŸ”® Cat Fusion</h5>
                <p class="fusion-info">Combine cats to create powerful new forms!</p>
                <button id="open-fusion-btn" class="jade-button small" onclick="openFusionModal()">
                  Open Fusion Lab
                </button>
              </div>
            </div>
          </div>

          <!-- Upgrades Tab -->
          <div id="upgrades-tab" class="tab-content">
            <div class="upgrade-category">
              <h4 class="category-header">ğŸ‘† Snoot Arts</h4>
              <div id="snoot-arts-list" class="upgrade-list"></div>
            </div>
            <div class="upgrade-category">
              <h4 class="category-header">â˜¯ï¸ Inner Cultivation</h4>
              <div id="inner-cultivation-list" class="upgrade-list"></div>
            </div>
          </div>

          <!-- Dungeons Tab (Replaces Pagoda) -->
          <div id="dungeons-tab" class="tab-content">
            <div class="dungeons-panel">
              <h4 class="category-header">ğŸ¯ Dungeons & Challenges</h4>

              <!-- Dungeon Selection -->
              <div class="dungeon-selector">
                <!-- Infinite Pagoda -->
                <div class="dungeon-card" data-dungeon="pagoda">
                  <div class="dungeon-icon">ğŸ¯</div>
                  <div class="dungeon-info">
                    <h5 class="dungeon-name">Infinite Pagoda</h5>
                    <p class="dungeon-desc">Climb endless floors for rewards</p>
                    <div class="dungeon-progress">
                      <span>Highest: <span id="pagoda-highest-floor">0</span></span>
                    </div>
                  </div>
                  <button class="jade-button small" onclick="selectDungeon('pagoda')">Enter</button>
                </div>

                <!-- Bamboo Forest (Wave Survival) -->
                <div class="dungeon-card" data-dungeon="bamboo">
                  <div class="dungeon-icon">ğŸ‹</div>
                  <div class="dungeon-info">
                    <h5 class="dungeon-name">Bamboo Forest</h5>
                    <p class="dungeon-desc">Survive 30 minutes of waves</p>
                    <div class="dungeon-progress">
                      <span>Best: <span id="bamboo-best-time">0:00</span></span>
                    </div>
                  </div>
                  <button class="jade-button small" onclick="selectDungeon('bamboo')">Enter</button>
                </div>

                <!-- Celestial Tournament -->
                <div class="dungeon-card" data-dungeon="tournament">
                  <div class="dungeon-icon">âš”ï¸</div>
                  <div class="dungeon-info">
                    <h5 class="dungeon-name">Celestial Tournament</h5>
                    <p class="dungeon-desc">Battle AI versions of the Seven Masters</p>
                    <div class="dungeon-progress">
                      <span>Wins: <span id="tournament-wins">0</span>/7</span>
                    </div>
                  </div>
                  <button class="jade-button small" onclick="selectDungeon('tournament')">Enter</button>
                </div>

                <!-- Dream Realm -->
                <div class="dungeon-card locked" data-dungeon="dream" data-unlock="nascentSoul">
                  <div class="dungeon-icon">ğŸŒ™</div>
                  <div class="dungeon-info">
                    <h5 class="dungeon-name">Dream Realm</h5>
                    <p class="dungeon-desc">Procedural dungeon from YOUR data</p>
                    <div class="dungeon-progress">
                      <span class="unlock-req">Requires: Nascent Soul</span>
                    </div>
                  </div>
                  <button class="jade-button small" disabled>Locked</button>
                </div>

                <!-- Goose Dimension -->
                <div class="dungeon-card locked" data-dungeon="goose" data-unlock="cobraChicken">
                  <div class="dungeon-icon">ğŸ¦¢</div>
                  <div class="dungeon-info">
                    <h5 class="dungeon-name">Goose Dimension</h5>
                    <p class="dungeon-desc">HONK. Everything is geese. HONK.</p>
                    <div class="dungeon-progress">
                      <span class="unlock-req">Defeat Cobra Chicken</span>
                    </div>
                  </div>
                  <button class="jade-button small" disabled>Locked</button>
                </div>

                <!-- Memory Fragments -->
                <div class="dungeon-card" data-dungeon="memory">
                  <div class="dungeon-icon">ğŸ“œ</div>
                  <div class="dungeon-info">
                    <h5 class="dungeon-name">Memory Fragments</h5>
                    <p class="dungeon-desc">Story dungeons that unlock lore</p>
                    <div class="dungeon-progress">
                      <span>Chapters: <span id="memory-chapters">0</span>/<span id="memory-total">?</span></span>
                    </div>
                  </div>
                  <button class="jade-button small" onclick="selectDungeon('memory')">Enter</button>
                </div>
              </div>

              <!-- Dungeon Stats Summary -->
              <div class="dungeon-stats-summary">
                <div class="dungeon-stat-item">
                  <span class="stat-icon">ğŸ«</span>
                  <span id="pagoda-tokens" class="stat-value">0</span>
                  <span class="stat-label">Tokens</span>
                </div>
                <div class="dungeon-stat-item">
                  <span class="stat-icon">ğŸ†</span>
                  <span id="dungeon-runs" class="stat-value">0</span>
                  <span class="stat-label">Runs</span>
                </div>
                <div class="dungeon-stat-item">
                  <span class="stat-icon">ğŸ’€</span>
                  <span id="bosses-defeated" class="stat-value">0</span>
                  <span class="stat-label">Bosses</span>
                </div>
              </div>

              <!-- Active Dungeon Run Display -->
              <div id="dungeon-active-run" class="dungeon-active-run hidden">
                <div class="dungeon-run-header">
                  <span id="active-dungeon-name">Infinite Pagoda</span>
                  <span id="active-dungeon-floor">Floor 1</span>
                </div>

                <!-- Combat Area -->
                <div id="pagoda-combat" class="pagoda-combat hidden">
                  <div class="combat-enemy">
                    <span id="enemy-emoji" class="enemy-emoji">ğŸ‘¹</span>
                    <span id="enemy-name" class="enemy-name">Enemy</span>
                    <div class="enemy-hp-bar">
                      <div id="enemy-hp-fill" class="hp-fill"></div>
                    </div>
                  </div>
                  <div class="combat-player">
                    <div class="player-hp-bar">
                      <div id="player-hp-fill" class="hp-fill player"></div>
                    </div>
                    <span id="player-hp-text">100/100</span>
                  </div>
                  <div id="combat-log" class="combat-log"></div>

                  <!-- Qi Meter for Boop Commands -->
                  <div class="qi-meter">
                    <span class="qi-label">Qi:</span>
                    <div class="qi-bar">
                      <div id="qi-fill" class="qi-fill" style="width: 0%"></div>
                    </div>
                    <span id="qi-amount" class="qi-amount">0/10</span>
                  </div>

                  <div class="boop-commands">
                    <button class="cmd-btn" data-cmd="power_strike" data-cost="1">ğŸ’ª Strike (1)</button>
                    <button class="cmd-btn" data-cmd="healing_touch" data-cost="1">ğŸ’š Heal (1)</button>
                    <button class="cmd-btn" data-cmd="shield_wall" data-cost="1">ğŸ›¡ï¸ Shield (1)</button>
                    <button class="cmd-btn" data-cmd="mega_boop" data-cost="3">ğŸ’¥ MEGA (3)</button>
                    <button class="cmd-btn" data-cmd="emergency_exit" data-cost="5">ğŸšª Flee (5)</button>
                  </div>
                </div>

                <!-- Run Actions -->
                <div class="run-actions">
                  <button id="auto-clear-btn" class="jade-button auto-clear-btn hidden" onclick="autoClearPagoda()">
                    âš¡ Auto-Clear
                    <span id="auto-clear-info" class="auto-clear-info"></span>
                  </button>
                  <button class="jade-button small danger" onclick="abandonRun()">Abandon Run</button>
                </div>
              </div>

              <!-- Start Dungeon Button -->
              <div id="dungeon-start-area" class="dungeon-start-area">
                <button id="start-pagoda-btn" class="jade-button pagoda-start-btn">
                  ğŸ¯ Enter the Pagoda
                </button>
              </div>
            </div>
          </div>

          <!-- Pagoda Tab (Legacy/Hidden - for compatibility) -->
          <div id="pagoda-tab" class="tab-content hidden-tab"></div>

          <!-- Equipment Tab -->
          <div id="equipment-tab" class="tab-content">
            <div class="equipment-panel">
              <h4 class="category-header">âš™ï¸ Cat Equipment</h4>
              <div id="equipment-stats-summary" class="equipment-stats-summary">
                <p class="empty-message">Equip items to see stats</p>
              </div>
              <div class="equipment-slots">
                <div class="equip-slot" data-slot="hat">
                  <span class="slot-icon">ğŸ©</span>
                  <span class="slot-name">Hat</span>
                  <div id="equip-hat" class="equipped-item">Empty</div>
                </div>
                <div class="equip-slot" data-slot="collar">
                  <span class="slot-icon">ğŸ“¿</span>
                  <span class="slot-name">Collar</span>
                  <div id="equip-collar" class="equipped-item">Empty</div>
                </div>
                <div class="equip-slot" data-slot="weapon">
                  <span class="slot-icon">âš”ï¸</span>
                  <span class="slot-name">Weapon</span>
                  <div id="equip-weapon" class="equipped-item">Empty</div>
                </div>
                <div class="equip-slot" data-slot="armor">
                  <span class="slot-icon">ğŸ›¡ï¸</span>
                  <span class="slot-name">Armor</span>
                  <div id="equip-armor" class="equipped-item">Empty</div>
                </div>
                <div class="equip-slot" data-slot="paws">
                  <span class="slot-icon">ğŸ¾</span>
                  <span class="slot-name">Paws</span>
                  <div id="equip-paws" class="equipped-item">Empty</div>
                </div>
                <div class="equip-slot" data-slot="tail">
                  <span class="slot-icon">ğŸ€</span>
                  <span class="slot-name">Tail</span>
                  <div id="equip-tail" class="equipped-item">Empty</div>
                </div>
              </div>
              <div class="inventory-controls">
                <h5 class="inventory-header">Inventory (<span id="inventory-count">0</span>)</h5>
                <div class="inventory-toolbar">
                  <input type="text" id="inventory-search" class="inventory-search" placeholder="Search...">
                  <select id="inventory-sort" class="inventory-sort">
                    <option value="rarity">Sort: Rarity</option>
                    <option value="slot">Sort: Slot</option>
                    <option value="level">Sort: Level</option>
                    <option value="name">Sort: Name</option>
                  </select>
                  <select id="inventory-filter" class="inventory-filter">
                    <option value="all">All Slots</option>
                    <option value="hat">ğŸ© Hats</option>
                    <option value="collar">ğŸ“¿ Collars</option>
                    <option value="weapon">âš”ï¸ Weapons</option>
                    <option value="armor">ğŸ›¡ï¸ Armor</option>
                    <option value="paws">ğŸ¾ Paws</option>
                    <option value="tail">ğŸ€ Tails</option>
                  </select>
                  <div class="view-toggle">
                    <button id="view-grid" class="view-btn active" title="Grid View">â–¦</button>
                    <button id="view-list" class="view-btn" title="List View">â˜°</button>
                  </div>
                </div>
              </div>
              <div id="equipment-inventory" class="equipment-inventory grid-view">
                <p class="empty-message">No equipment yet!</p>
              </div>
            </div>
          </div>

          <!-- Forge Tab -->
          <div id="forge-tab" class="tab-content">
            <div class="forge-panel">
              <h4 class="category-header">ğŸ”¨ Equipment Forge</h4>

              <!-- Item Selection -->
              <div class="forge-section">
                <h5 class="forge-subtitle">Select Equipment to Upgrade</h5>
                <select id="forge-item-select" class="forge-select">
                  <option value="">-- Select Item --</option>
                </select>
              </div>

              <!-- Selected Item Display -->
              <div id="forge-item-display" class="forge-item-display hidden">
                <div class="forge-item-header">
                  <span id="forge-item-name" class="forge-item-name">Item Name</span>
                  <span id="forge-item-level" class="forge-item-level">+0</span>
                </div>
                <div id="forge-item-stats" class="forge-item-stats"></div>
                <div id="forge-item-enchants" class="forge-item-enchants"></div>
              </div>

              <!-- Upgrade Section -->
              <div class="forge-section">
                <h5 class="forge-subtitle">â¬†ï¸ Upgrade Equipment</h5>
                <div id="upgrade-cost" class="forge-cost"></div>
                <div class="forge-options">
                  <label class="forge-checkbox">
                    <input type="checkbox" id="use-protection"> ğŸ›¡ï¸ Protection Charm (<span id="protection-count">0</span>)
                  </label>
                  <label class="forge-checkbox">
                    <input type="checkbox" id="use-clover"> ğŸ€ Lucky Clover (<span id="clover-count">0</span>)
                  </label>
                </div>
                <button id="upgrade-btn" class="jade-button forge-btn" onclick="upgradeSelectedItem()">
                  Upgrade
                </button>
                <div id="upgrade-result" class="forge-result"></div>
              </div>

              <!-- Enchant Section -->
              <div class="forge-section">
                <h5 class="forge-subtitle">âœ¨ Enchantments</h5>
                <select id="enchant-select" class="forge-select">
                  <option value="">-- Select Enchantment --</option>
                </select>
                <div id="enchant-cost" class="forge-cost"></div>
                <button id="enchant-btn" class="jade-button forge-btn" onclick="enchantSelectedItem()">
                  Apply Enchantment
                </button>
              </div>

              <!-- Materials Display -->
              <div class="forge-section">
                <h5 class="forge-subtitle">ğŸ“¦ Materials</h5>
                <div id="materials-display" class="materials-grid"></div>
              </div>
            </div>
          </div>

          <!-- Expeditions Tab -->
          <div id="expeditions-tab" class="tab-content">
            <div class="expedition-panel">
              <h4 class="category-header">ğŸ—ºï¸ Send Cats on Expeditions</h4>
              <p class="expedition-info" style="font-size: 8px; color: #888; margin-bottom: 10px;">
                Select a destination and choose cats to send.
              </p>
              <div id="expedition-destinations" class="expedition-destinations"></div>

              <div id="expedition-selection" class="expedition-selection hidden">
                <h5 style="font-size: 9px; color: var(--jade-light); margin: 15px 0 10px;">Select Cats:</h5>
                <div id="cat-select-grid" class="cat-select-grid"></div>
                <button id="start-expedition-btn" class="jade-button" style="margin-top: 10px; width: 100%;" onclick="startSelectedExpedition()">
                  Start Expedition
                </button>
              </div>

              <div class="active-expeditions" style="margin-top: 20px;">
                <h4 class="category-header">ğŸ“ Active Expeditions</h4>
                <div id="active-expeditions-list"></div>
              </div>
            </div>

            <div style="margin-top: 20px; text-align: center;">
              <button id="minigame-btn" class="minigame-button">
                ğŸ’ Chase the Jade Dot!
              </button>
            </div>
          </div>

          <!-- Catino (Casino) Tab -->
          <div id="catino-tab" class="tab-content">
            <div class="catino-panel">
              <h4 class="category-header">ğŸ° Cat-sino</h4>
              <p class="catino-subtitle">Fortune favors the bold (and the fluffy)</p>

              <div class="catino-balance">
                <span class="balance-label">Balance:</span>
                <span id="catino-chips" class="balance-value">0</span>
                <span style="font-size: 8px; color: #888;">BP</span>
              </div>
              <div id="catino-status" class="catino-status" style="font-size: 7px; color: #888; margin-bottom: 10px;"></div>

              <!-- Slot Machine -->
              <div class="catino-game slot-machine">
                <h5>ğŸ° Lucky Slots</h5>
                <div class="slot-display">
                  <div class="slot-reel" id="reel-1">â“</div>
                  <div class="slot-reel" id="reel-2">â“</div>
                  <div class="slot-reel" id="reel-3">â“</div>
                </div>
                <div class="slot-controls">
                  <select id="slot-bet">
                    <option value="1">100 BP</option>
                    <option value="5">500 BP</option>
                    <option value="10">1K BP</option>
                    <option value="50">5K BP</option>
                  </select>
                  <button id="spin-slots-btn" class="jade-button" onclick="spinSlots()">SPIN!</button>
                </div>
                <p id="slot-result" class="slot-result"></p>
              </div>

              <!-- Goose Racing -->
              <div class="catino-game goose-racing">
                <h5>ğŸ¦¢ Goose Racing</h5>
                <div class="race-track">
                  <div class="race-lane" id="lane-1"><span class="racer">ğŸ¦¢</span><span class="name">Honky</span></div>
                  <div class="race-lane" id="lane-2"><span class="racer">ğŸ¦†</span><span class="name">Quackers</span></div>
                  <div class="race-lane" id="lane-3"><span class="racer">ğŸ¦</span><span class="name">Speedy</span></div>
                </div>
                <div class="race-controls">
                  <select id="race-pick">
                    <option value="0">Honky (2x)</option>
                    <option value="1">Quackers (3x)</option>
                    <option value="2">Speedy (4x)</option>
                  </select>
                  <input type="number" id="race-bet" value="10" min="1" max="100" style="width: 50px;">
                  <button id="start-race-btn" class="jade-button" onclick="startGooseRace()">BET!</button>
                </div>
                <p id="race-result" class="race-result"></p>
              </div>

              <!-- Mystery Box -->
              <div class="catino-game mystery-box">
                <h5>ğŸ“¦ Mystery Box</h5>
                <p class="mystery-desc">What could be inside?</p>
                <div class="mystery-options">
                  <button class="mystery-btn" onclick="openMysteryBox('common')">ğŸ Common<br>5 Chips</button>
                  <button class="mystery-btn rare" onclick="openMysteryBox('rare')">ğŸ’ Rare<br>25 Chips</button>
                  <button class="mystery-btn legendary" onclick="openMysteryBox('legendary')">â­ Legendary<br>100 Chips</button>
                </div>
                <p id="mystery-result" class="mystery-result"></p>
              </div>
            </div>
          </div>

          <!-- Partners Tab -->
          <div id="partners-tab" class="tab-content">
            <div class="partners-panel">
              <h4 class="category-header">ğŸ’• Partner Generator</h4>
              <p class="partners-subtitle">Summon companions for your journey</p>

              <div class="partner-summon">
                <button id="summon-partner-btn" class="jade-button summon-btn" onclick="summonPartner()">
                  âœ¨ Summon Partner (1000 BP)
                </button>
                <div id="partner-result" class="partner-result hidden">
                  <div class="partner-portrait" id="new-partner-portrait"></div>
                  <div class="partner-info">
                    <h5 id="new-partner-name"></h5>
                    <p id="new-partner-rarity"></p>
                    <p id="new-partner-element"></p>
                    <p id="new-partner-traits"></p>
                  </div>
                  <button class="jade-button small" onclick="keepPartner()">Keep</button>
                </div>
              </div>

              <div class="owned-partners">
                <h5>Your Partners (<span id="partner-count">0</span>)</h5>
                <div id="partner-collection" class="partner-collection">
                  <p class="empty-message">No partners yet. Summon your first!</p>
                </div>
              </div>

              <div class="partner-stats">
                <p>Partners Summoned: <span id="partners-summoned">0</span></p>
                <p>Mythics Found: <span id="mythics-found">0</span></p>
              </div>
            </div>
          </div>

          <!-- Facilities Tab (Legacy - redirect to Buildings) -->
          <div id="facilities-tab" class="tab-content hidden-tab"></div>

          <!-- Buildings Tab (Expanded) -->
          <div id="buildings-tab" class="tab-content">
            <div class="buildings-panel">
              <h4 class="category-header">ğŸ—ï¸ Sect Buildings</h4>

              <!-- Territory Selector -->
              <div class="territory-selector">
                <h5 class="section-header">Current Territory</h5>
                <div class="territory-display">
                  <span id="current-territory-icon" class="territory-icon">ğŸ </span>
                  <div class="territory-info">
                    <span id="current-territory-name" class="territory-name">Humble Courtyard</span>
                    <span id="territory-capacity" class="territory-cap">Cap: 10 cats | 3 slots</span>
                  </div>
                </div>
                <div class="territory-options">
                  <button class="territory-btn active" data-territory="humble_courtyard" title="Humble Courtyard">ğŸ </button>
                  <button class="territory-btn locked" data-territory="mountain_sanctuary" title="Mountain Sanctuary (1M BP)">â›°ï¸</button>
                  <button class="territory-btn locked" data-territory="floating_palace" title="Floating Palace (50M BP)">ğŸ°</button>
                  <button class="territory-btn locked" data-territory="celestial_realm" title="Celestial Realm (1B BP)">âœ¨</button>
                </div>
              </div>

              <!-- Building Slots Display -->
              <div class="building-slots-display">
                <span class="slots-label">Building Slots:</span>
                <span id="used-slots" class="slots-used">0</span>/<span id="total-slots" class="slots-total">3</span>
              </div>

              <!-- Building Categories -->
              <div class="building-categories">
                <button class="building-cat-btn active" data-category="core">ğŸ›ï¸ Core</button>
                <button class="building-cat-btn" data-category="production">âš™ï¸ Production</button>
                <button class="building-cat-btn" data-category="social">ğŸ’• Social</button>
                <button class="building-cat-btn" data-category="utility">ğŸ”§ Utility</button>
                <button class="building-cat-btn" data-category="special">â­ Special</button>
              </div>

              <!-- Buildings Grid -->
              <div id="buildings-grid" class="buildings-grid">
                <!-- Core Buildings -->
                <div class="building-card" data-building="cat_pagoda">
                  <div class="building-icon">ğŸ¯</div>
                  <div class="building-info">
                    <h5 class="building-name">Cat Pagoda</h5>
                    <p class="building-effect">+10 cat capacity/level</p>
                    <span class="building-level">Level <span id="cat_pagoda-level">0</span>/10</span>
                  </div>
                  <div class="building-cost">
                    <span id="cat_pagoda-cost">10,000 BP</span>
                  </div>
                  <button class="jade-button small" onclick="buildBuilding('cat_pagoda')">Build</button>
                </div>

                <div class="building-card" data-building="meditation_garden">
                  <div class="building-icon">ğŸŒ¸</div>
                  <div class="building-info">
                    <h5 class="building-name">Meditation Garden</h5>
                    <p class="building-effect">+25% idle PP</p>
                    <span class="building-level">Level <span id="meditation_garden-level">0</span>/10</span>
                  </div>
                  <div class="building-cost">
                    <span id="meditation_garden-cost">50,000 BP</span>
                  </div>
                  <button class="jade-button small" onclick="buildBuilding('meditation_garden')">Build</button>
                </div>

                <div class="building-card" data-building="training_dojo">
                  <div class="building-icon">ğŸ¥‹</div>
                  <div class="building-info">
                    <h5 class="building-name">Training Dojo</h5>
                    <p class="building-effect">Cat training & techniques</p>
                    <span class="building-level">Level <span id="training_dojo-level">0</span>/10</span>
                  </div>
                  <div class="building-cost">
                    <span id="training_dojo-cost">100,000 BP</span>
                  </div>
                  <button class="jade-button small" onclick="buildBuilding('training_dojo')">Build</button>
                </div>

                <div class="building-card" data-building="waifu_quarters">
                  <div class="building-icon">ğŸ’•</div>
                  <div class="building-info">
                    <h5 class="building-name">Waifu Quarters</h5>
                    <p class="building-effect">Daily gifts, bond bonuses</p>
                    <span class="building-level">Level <span id="waifu_quarters-level">0</span>/10</span>
                  </div>
                  <div class="building-cost">
                    <span id="waifu_quarters-cost">200,000 BP</span>
                  </div>
                  <button class="jade-button small" onclick="buildBuilding('waifu_quarters')">Build</button>
                </div>

                <div class="building-card" data-building="goose_watchtower">
                  <div class="building-icon">ğŸ¦¢</div>
                  <div class="building-info">
                    <h5 class="building-name">Goose Watchtower</h5>
                    <p class="building-effect">+5% goose spawn, warnings</p>
                    <span class="building-level">Level <span id="goose_watchtower-level">0</span>/10</span>
                  </div>
                  <div class="building-cost">
                    <span id="goose_watchtower-cost">250,000 BP</span>
                  </div>
                  <button class="jade-button small" onclick="buildBuilding('goose_watchtower')">Build</button>
                </div>

                <div class="building-card" data-building="hot_springs">
                  <div class="building-icon">â™¨ï¸</div>
                  <div class="building-info">
                    <h5 class="building-name">Hot Springs</h5>
                    <p class="building-effect">Recovery, bond events</p>
                    <span class="building-level">Level <span id="hot_springs-level">0</span>/5</span>
                  </div>
                  <div class="building-cost">
                    <span id="hot_springs-cost">750,000 BP</span>
                  </div>
                  <button class="jade-button small" onclick="buildBuilding('hot_springs')">Build</button>
                </div>
              </div>

              <!-- Building Effects Summary -->
              <div class="building-effects-summary">
                <h5 class="section-header">Active Effects</h5>
                <div id="building-effects-list" class="effects-list">
                  <p class="empty-message">Build structures to gain effects!</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Prestige Tab (Three-Layer System) -->
          <div id="prestige-tab" class="tab-content">
            <div class="prestige-panel-full">
              <h4 class="category-header">ğŸŒŸ Prestige & Ascension</h4>

              <!-- Layer 1: Ascension -->
              <div class="prestige-layer" data-layer="ascension">
                <div class="layer-header">
                  <span class="layer-icon">ğŸ”®</span>
                  <div class="layer-info">
                    <h5 class="layer-name">Ascension</h5>
                    <span class="layer-desc">Reset for Heavenly Seals</span>
                  </div>
                  <span id="ascension-count" class="layer-count">0</span>
                </div>

                <div class="layer-progress">
                  <div class="progress-bar">
                    <div id="ascension-progress-fill" class="progress-fill" style="width: 0%"></div>
                  </div>
                  <div class="progress-text">
                    <span id="ascension-current">0 PP</span>
                    <span id="ascension-requirement">1B PP</span>
                  </div>
                </div>

                <div class="layer-rewards">
                  <span class="rewards-label">You will gain:</span>
                  <div class="rewards-preview">
                    <span id="ascension-seals-preview" class="reward-item">ğŸ”® 0 Heavenly Seals</span>
                    <span id="ascension-mult-preview" class="reward-item">âœ¨ 1.5x Multiplier</span>
                  </div>
                </div>

                <div class="layer-decree hidden" id="decree-selection">
                  <span class="decree-label">Choose Heavenly Decree:</span>
                  <div class="decree-options">
                    <button class="decree-btn" data-decree="speed">âš¡ Swiftness</button>
                    <button class="decree-btn" data-decree="wealth">ğŸ’° Prosperity</button>
                    <button class="decree-btn" data-decree="fortune">ğŸ€ Fortune</button>
                    <button class="decree-btn" data-decree="bonds">ğŸ’• Bonds</button>
                    <button class="decree-btn" data-decree="combat">âš”ï¸ War</button>
                  </div>
                </div>

                <button id="ascension-btn" class="jade-button prestige-btn" disabled onclick="performAscension()">
                  ğŸ”® Ascend (1B PP Required)
                </button>
              </div>

              <!-- Layer 2: Reincarnation -->
              <div class="prestige-layer locked" data-layer="reincarnation">
                <div class="layer-header">
                  <span class="layer-icon">ğŸŒ€</span>
                  <div class="layer-info">
                    <h5 class="layer-name">Reincarnation</h5>
                    <span class="layer-desc">Reset Ascensions for Karma</span>
                  </div>
                  <span id="reincarnation-count" class="layer-count">0</span>
                </div>

                <div class="layer-unlock-req">
                  <span>Requires: 10 Ascensions + 500 Heavenly Seals</span>
                  <span id="reincarnation-progress">0/10 Ascensions, 0/500 Seals</span>
                </div>

                <div class="layer-progress hidden">
                  <div class="progress-bar">
                    <div id="reincarnation-progress-fill" class="progress-fill karma" style="width: 0%"></div>
                  </div>
                </div>

                <div class="layer-rewards hidden">
                  <span class="rewards-label">You will gain:</span>
                  <div class="rewards-preview">
                    <span id="reincarnation-karma-preview" class="reward-item">ğŸŒ€ 0 Karma Points</span>
                    <span id="reincarnation-mult-preview" class="reward-item">âœ¨ 2x Multiplier</span>
                    <span class="reward-item">ğŸ§  Past Life Memory</span>
                  </div>
                </div>

                <button id="reincarnation-btn" class="jade-button prestige-btn" disabled onclick="performReincarnation()">
                  ğŸŒ€ Reincarnate (Locked)
                </button>
              </div>

              <!-- Layer 3: Transcendence -->
              <div class="prestige-layer locked ultimate" data-layer="transcendence">
                <div class="layer-header">
                  <span class="layer-icon">ğŸŒŒ</span>
                  <div class="layer-info">
                    <h5 class="layer-name">Transcendence</h5>
                    <span class="layer-desc">The Ultimate Reset</span>
                  </div>
                  <span id="transcendence-count" class="layer-count">0</span>
                </div>

                <div class="layer-unlock-req">
                  <span>Requires: 5 Reincarnations + 1000 Karma + True Immortal Realm</span>
                </div>

                <div class="layer-rewards hidden">
                  <span class="rewards-label">Unlocks:</span>
                  <div class="rewards-preview">
                    <span class="reward-item">ğŸŒŒ Celestial Realm</span>
                    <span class="reward-item">ğŸ“– True Story Ending</span>
                    <span class="reward-item">â™¾ï¸ Infinite Scaling</span>
                  </div>
                </div>

                <button id="transcendence-btn" class="jade-button prestige-btn ultimate" disabled onclick="performTranscendence()">
                  ğŸŒŒ Transcend (Locked)
                </button>
              </div>

              <!-- Prestige Shop -->
              <div class="prestige-shop">
                <h5 class="section-header">Heavenly Seal Shop</h5>
                <div class="seal-balance">
                  <span>ğŸ”® Heavenly Seals: <span id="seal-balance">0</span></span>
                </div>
                <div id="seal-shop-items" class="seal-shop-grid">
                  <div class="seal-item" data-cost="5">
                    <span class="item-name">Forbidden Techniques</span>
                    <span class="item-cost">5 ğŸ”®</span>
                  </div>
                  <div class="seal-item" data-cost="10">
                    <span class="item-name">Eighth Master Hints</span>
                    <span class="item-cost">10 ğŸ”®</span>
                  </div>
                  <div class="seal-item" data-cost="25">
                    <span class="item-name">Start with Waifu</span>
                    <span class="item-cost">25 ğŸ”®</span>
                  </div>
                  <div class="seal-item" data-cost="100">
                    <span class="item-name">Unlock Eighth Master</span>
                    <span class="item-cost">100 ğŸ”®</span>
                  </div>
                </div>
              </div>

              <!-- Legacy Prestige Panel for compatibility -->
              <div id="prestige-legacy" class="prestige-legacy hidden">
                <div class="prestige-multiplier">
                  <span id="prestige-multiplier" class="multiplier-value">1.0x</span>
                  <span class="multiplier-label">All Gains</span>
                </div>
                <span id="prestige-tier-name" class="tier-name">Mortal</span>
                <div class="prestige-progress-bar">
                  <div id="prestige-progress-fill" class="prestige-progress-fill" style="width: 0%"></div>
                </div>
                <span id="prestige-current">0 BP</span>
                <span id="prestige-requirement">100K BP</span>
                <button id="rebirth-btn" class="rebirth-button" disabled>ğŸ”„ Ascend</button>
                <div id="prestige-perks-list"></div>
              </div>
            </div>
          </div>

          <!-- Techniques Tab -->
          <div id="techniques-tab" class="tab-content">
            <div class="techniques-panel">
              <!-- Legendary Internals -->
              <div class="technique-section">
                <h4 class="category-header">ğŸ‰ Legendary Internals</h4>
                <div id="legendary-internals-list" class="technique-list legendary-list">
                  <p class="empty-message">Reach higher pagoda floors to unlock legendary cultivation methods.</p>
                </div>
              </div>

              <!-- Secret Techniques -->
              <div class="technique-section">
                <h4 class="category-header">ğŸ“œ Secret Techniques</h4>
                <div id="secret-techniques-list" class="technique-list">
                  <p class="empty-message">Defeat Pagoda bosses to learn their secret techniques.</p>
                </div>
              </div>

              <!-- Hidden Skills -->
              <div class="technique-section">
                <h4 class="category-header">ğŸ”® Hidden Skills</h4>
                <div id="hidden-skills-list" class="technique-list">
                  <p class="empty-message">Achieve great feats to discover hidden skills.</p>
                </div>
              </div>

              <!-- Cultivation Passives -->
              <div class="technique-section">
                <h4 class="category-header">âœ¨ Cultivation Passives</h4>
                <div id="cultivation-passives-list" class="technique-list">
                  <p class="empty-message">Progress through the game to unlock cultivation passives.</p>
                </div>
              </div>

              <!-- Consumables -->
              <div class="technique-section">
                <h4 class="category-header">ğŸ’Š Consumables</h4>
                <div id="consumables-list" class="consumables-grid">
                  <p class="empty-message">Collect consumables from the Pagoda.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Relics Tab -->
          <div id="relics-tab" class="tab-content">
            <div class="relics-panel">
              <h4 class="category-header">ğŸº Dungeon Relics</h4>
              <p class="relics-info">Collect relics during dungeon runs for permanent bonuses!</p>

              <!-- Relic Stats -->
              <div class="relic-stats">
                <div class="relic-stat">
                  <span class="stat-icon">ğŸº</span>
                  <span id="relics-owned" class="stat-value">0</span>
                  <span class="stat-label">Relics Owned</span>
                </div>
                <div class="relic-stat">
                  <span class="stat-icon">â­</span>
                  <span id="relic-power" class="stat-value">0%</span>
                  <span class="stat-label">Total Bonus</span>
                </div>
              </div>

              <!-- Relic Categories -->
              <div class="relic-categories">
                <button class="relic-cat-btn active" data-rarity="all">All</button>
                <button class="relic-cat-btn" data-rarity="common">Common</button>
                <button class="relic-cat-btn" data-rarity="rare">Rare</button>
                <button class="relic-cat-btn" data-rarity="epic">Epic</button>
                <button class="relic-cat-btn" data-rarity="legendary">Legendary</button>
                <button class="relic-cat-btn" data-rarity="mythic">Mythic</button>
              </div>

              <!-- Relics Grid -->
              <div id="relics-grid" class="relics-grid">
                <!-- Common Relics -->
                <div class="relic-card common" data-relic="lucky_coin">
                  <div class="relic-icon">ğŸª™</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Lucky Coin</h5>
                    <p class="relic-effect">+10% loot drop rate</p>
                  </div>
                  <span class="relic-owned">x<span id="lucky_coin-count">0</span></span>
                </div>

                <div class="relic-card common" data-relic="catnip_pouch">
                  <div class="relic-icon">ğŸŒ¿</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Catnip Pouch</h5>
                    <p class="relic-effect">+20% Qi regeneration</p>
                  </div>
                  <span class="relic-owned">x<span id="catnip_pouch-count">0</span></span>
                </div>

                <!-- Rare Relics -->
                <div class="relic-card rare locked" data-relic="box_dimension">
                  <div class="relic-icon">ğŸ“¦</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Pocket Dimension Box</h5>
                    <p class="relic-effect">25% double loot chance</p>
                  </div>
                  <span class="relic-owned">x<span id="box_dimension-count">0</span></span>
                </div>

                <div class="relic-card rare locked" data-relic="nine_lives_charm">
                  <div class="relic-icon">ğŸ±</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Nine Lives Charm</h5>
                    <p class="relic-effect">15% auto-revive chance</p>
                  </div>
                  <span class="relic-owned">x<span id="nine_lives_charm-count">0</span></span>
                </div>

                <!-- Epic Relics -->
                <div class="relic-card epic locked" data-relic="goose_horn">
                  <div class="relic-icon">ğŸ“¯</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Horn of the Goose</h5>
                    <p class="relic-effect">Summon goose every 5 floors</p>
                  </div>
                  <span class="relic-owned">x<span id="goose_horn-count">0</span></span>
                </div>

                <div class="relic-card epic locked" data-relic="waifu_blessing">
                  <div class="relic-icon">ğŸ’–</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Waifu Blessing</h5>
                    <p class="relic-effect">-50% waifu skill cooldown</p>
                  </div>
                  <span class="relic-owned">x<span id="waifu_blessing-count">0</span></span>
                </div>

                <!-- Legendary Relics -->
                <div class="relic-card legendary locked" data-relic="eternal_catnip">
                  <div class="relic-icon">âœ¨</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Eternal Catnip</h5>
                    <p class="relic-effect">+20% all stats, start full Qi</p>
                  </div>
                  <span class="relic-owned">x<span id="eternal_catnip-count">0</span></span>
                </div>

                <div class="relic-card legendary locked" data-relic="developers_mouse">
                  <div class="relic-icon">ğŸ–±ï¸</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Developer's Mouse</h5>
                    <p class="relic-effect">See enemy HP & floor preview</p>
                  </div>
                  <span class="relic-owned">x<span id="developers_mouse-count">0</span></span>
                </div>

                <!-- Mythic Relics -->
                <div class="relic-card mythic locked" data-relic="snoot_prime">
                  <div class="relic-icon">ğŸ‘ƒ</div>
                  <div class="relic-info">
                    <h5 class="relic-name">Fragment of Snoot Prime</h5>
                    <p class="relic-effect">3x Boop Command damage</p>
                  </div>
                  <span class="relic-owned">x<span id="snoot_prime-count">0</span></span>
                </div>
              </div>

              <!-- Relic Set Bonuses -->
              <div class="relic-sets">
                <h5 class="section-header">Active Set Bonuses</h5>
                <div id="active-relic-sets" class="relic-sets-list">
                  <p class="empty-message">Collect matching relics for set bonuses!</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Codex Tab (Expanded Lore System) -->
          <div id="codex-tab" class="tab-content">
            <div class="codex-panel">
              <h4 class="category-header">ğŸ“– Celestial Codex</h4>
              <p class="codex-subtitle">Secrets of the Snoot Sect</p>

              <!-- Codex Stats -->
              <div class="codex-stats">
                <div class="codex-stat">
                  <span class="stat-icon">ğŸ“œ</span>
                  <span id="lore-fragments-count" class="stat-value">0</span>
                  <span class="stat-label">Fragments</span>
                </div>
                <div class="codex-stat">
                  <span class="stat-icon">ğŸ“–</span>
                  <span id="stories-unlocked" class="stat-value">0</span>
                  <span class="stat-label">Stories</span>
                </div>
                <div class="codex-stat">
                  <span class="stat-icon">ğŸ”</span>
                  <span id="secrets-found" class="stat-value">0</span>
                  <span class="stat-label">Secrets</span>
                </div>
              </div>

              <!-- Codex Categories -->
              <div class="codex-categories">
                <button class="codex-cat-btn active" data-codex-cat="masters">ğŸ‘¤ Masters</button>
                <button class="codex-cat-btn" data-codex-cat="waifus">ğŸ’• Waifus</button>
                <button class="codex-cat-btn" data-codex-cat="cats">ğŸ± Cats</button>
                <button class="codex-cat-btn" data-codex-cat="geese">ğŸ¦¢ Geese</button>
                <button class="codex-cat-btn" data-codex-cat="history">ğŸ“œ History</button>
                <button class="codex-cat-btn" data-codex-cat="secrets">ğŸ”® Secrets</button>
              </div>

              <!-- Codex Content -->
              <div id="codex-entries" class="codex-entries">
                <!-- Masters Section -->
                <div class="codex-section" data-section="masters">
                  <div class="codex-entry" data-entry="gerald">
                    <div class="entry-header">
                      <span class="entry-icon">ğŸ‰</span>
                      <span class="entry-name">Gerald - The Jade Palm</span>
                      <span class="entry-progress">0/5 fragments</span>
                    </div>
                    <div class="entry-content locked">
                      <p class="locked-text">Collect fragments to unlock this story...</p>
                    </div>
                  </div>

                  <div class="codex-entry" data-entry="rusty">
                    <div class="entry-header">
                      <span class="entry-icon">ğŸ‘Š</span>
                      <span class="entry-name">Rusty - The Crimson Fist</span>
                      <span class="entry-progress">0/5 fragments</span>
                    </div>
                    <div class="entry-content locked">
                      <p class="locked-text">Collect fragments to unlock this story...</p>
                    </div>
                  </div>

                  <div class="codex-entry" data-entry="eighth_master" class="secret-entry hidden">
                    <div class="entry-header">
                      <span class="entry-icon">â“</span>
                      <span class="entry-name">??? - The Forgotten One</span>
                      <span class="entry-progress">0/15 fragments</span>
                    </div>
                    <div class="entry-content locked">
                      <p class="locked-text">A great mystery awaits...</p>
                    </div>
                  </div>
                </div>

                <!-- Relationships Section -->
                <div class="codex-section hidden" data-section="relationships">
                  <div class="codex-entry" data-entry="gerald_rusty">
                    <div class="entry-header">
                      <span class="entry-icon">âš”ï¸</span>
                      <span class="entry-name">The First Meeting</span>
                      <span class="entry-progress">0/10 fragments</span>
                    </div>
                    <div class="entry-content locked">
                      <p class="locked-text">Play as Gerald and Rusty to unlock...</p>
                    </div>
                  </div>
                </div>

                <!-- Waifu Secrets Section -->
                <div class="codex-section hidden" data-section="waifus">
                  <div class="codex-entry" data-entry="mochi_secret">
                    <div class="entry-header">
                      <span class="entry-icon">ğŸ¡</span>
                      <span class="entry-name">Mochi's Hidden Past</span>
                      <span class="entry-progress">0/10 fragments</span>
                    </div>
                    <div class="entry-content locked">
                      <p class="locked-text">Reach max bond to unlock...</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recent Fragment Discoveries -->
              <div class="recent-discoveries">
                <h5 class="section-header">Recent Discoveries</h5>
                <div id="recent-fragments" class="recent-list">
                  <p class="empty-message">Play to discover lore fragments!</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Shop Tab -->
          <div id="shop-tab" class="tab-content">
            <div class="shop-panel">
              <div class="shop-header">
                <div class="shop-keeper">
                  <span class="shop-keeper-portrait">ğŸ¦…</span>
                  <div class="shop-keeper-info">
                    <h4 class="shop-keeper-name">BombayClyde</h4>
                    <p class="shop-keeper-title">Licensed Merchant of the Flying Eagle Stronghold</p>
                  </div>
                </div>
                <div class="shop-lore">
                  <p class="lore-text">"Welcome, cultivator! All transactions here follow the sacred laws of the <span class="highlight">Flying Eagle Stronghold</span>. The Seven Masters have sworn to uphold these ancient trade agreements - no funny business, fair prices, and absolutely NO refunds on catnip."</p>
                </div>
              </div>

              <div class="shop-balance">
                <span>ğŸ’° BP: </span>
                <span id="shop-bp-display" class="shop-bp">0</span>
                <span class="shop-balance-divider">|</span>
                <span>ğŸŒ¿ Jade Catnip: </span>
                <span id="shop-jade-display" class="shop-jade">0</span>
              </div>

              <div class="shop-categories">
                <button class="shop-cat-btn active" data-category="equipment">âš”ï¸ Equipment</button>
                <button class="shop-cat-btn" data-category="materials">ğŸ“¦ Materials</button>
                <button class="shop-cat-btn" data-category="consumables">ğŸ§ª Consumables</button>
                <button class="shop-cat-btn" data-category="special">âœ¨ Special</button>
              </div>

              <div class="shop-dialogue" id="shop-dialogue">
                <p>"The Flying Eagle Stronghold guarantees quality! ...mostly."</p>
              </div>

              <div id="shop-items" class="shop-items">
                <!-- Items populated by JS -->
              </div>

              <div class="shop-footer">
                <p class="shop-footer-text">ğŸ¦… "By the wings of the Flying Eagle, may your snoots be ever boopable." - Ancient Merchant Blessing</p>
              </div>
            </div>
          </div>

          <!-- Stats Tab -->
          <div id="stats-tab" class="tab-content">
            <!-- Goose Ally Section -->
            <div id="goose-ally-section" class="goose-ally-section hidden">
              <h4 class="category-header">ğŸ¦¢ Goose Ally</h4>
              <div id="current-ally-display" class="current-ally">
                <span id="ally-emoji" class="ally-portrait">ğŸ¦¢</span>
                <div class="ally-info">
                  <span id="ally-name" class="ally-name">None Selected</span>
                  <span id="ally-effect" class="ally-effect">Defeat Cobra Chicken to unlock</span>
                </div>
              </div>
              <div id="ally-selection" class="ally-selection">
                <button class="ally-btn" data-ally="guard" title="Guard Goose">
                  ğŸ›¡ï¸
                  <span class="ally-label">Guard</span>
                </button>
                <button class="ally-btn" data-ally="attack" title="Attack Goose">
                  âš”ï¸
                  <span class="ally-label">Attack</span>
                </button>
                <button class="ally-btn" data-ally="chaos" title="Chaos Goose">
                  ğŸŒ€
                  <span class="ally-label">Chaos</span>
                </button>
                <button class="ally-btn" data-ally="honk" title="Honk Goose">
                  ğŸ“¢
                  <span class="ally-label">Honk</span>
                </button>
              </div>
              <p id="ally-quote" class="ally-quote"></p>
            </div>

            <div class="stats-panel">
              <h4 class="category-header">ğŸ“Š Cultivation Records</h4>
              <div class="stats-grid">
                <div class="stat-item">
                  <p class="stat-label">Total Boops</p>
                  <p id="stat-total-boops" class="stat-value">0</p>
                </div>
                <div class="stat-item">
                  <p class="stat-label">Critical Boops</p>
                  <p id="stat-crit-boops" class="stat-value jade">0</p>
                </div>
                <div class="stat-item">
                  <p class="stat-label">Max Combo</p>
                  <p id="stat-max-combo" class="stat-value">0</p>
                </div>
                <div class="stat-item">
                  <p class="stat-label">Cats Recruited</p>
                  <p id="stat-cats" class="stat-value jade">0</p>
                </div>
                <div class="stat-item">
                  <p class="stat-label">Geese Booped</p>
                  <p id="stat-geese" class="stat-value">0</p>
                </div>
                <div class="stat-item">
                  <p class="stat-label">Highest Realm</p>
                  <p id="stat-highest-realm" class="stat-value">-</p>
                </div>
                <div class="stat-item">
                  <p class="stat-label">Play Time</p>
                  <p id="stat-playtime" class="stat-value">0h 0m</p>
                </div>
                <div class="stat-item">
                  <p class="stat-label">AFK Time</p>
                  <p id="stat-afk-time" class="stat-value">0h 0m</p>
                </div>
              </div>

              <h4 class="category-header" style="margin-top: 20px;">ğŸ† Achievements</h4>
              <div id="achievement-progress" class="achievement-progress">
                <p class="stat-label">Progress: <span id="achievement-count">0</span>/<span id="achievement-total">0</span></p>
                <div class="bond-bar" style="margin-top: 8px;">
                  <div id="achievement-bar" class="bond-fill" style="width: 0%; background: var(--gold-accent);"></div>
                </div>
              </div>

              <h4 class="category-header" style="margin-top: 20px;">ğŸ“œ Lore & Secrets</h4>
              <div class="codex-preview">
                <p class="stat-label">Lore Fragments: <span id="lore-count">0</span>/<span id="lore-total">0</span></p>
                <button id="open-codex-btn" class="jade-button small" style="margin-top: 10px;">
                  ğŸ“– Open Codex
                </button>
              </div>

              <div class="danger-zone" style="margin-top: 30px; padding-top: 20px; border-top: 2px dashed #ff4444;">
                <h4 class="category-header" style="color: #ff4444;">âš ï¸ Danger Zone</h4>
                <button id="reset-btn" class="reset-button">
                  ğŸ—‘ï¸ Reset All Progress
                </button>
              </div>
            </div>
          </div>
        </aside>
      </div>

      <!-- Footer -->
      <footer class="game-footer">
        <p id="master-quote" class="master-quote"></p>
        <div id="save-indicator" class="save-indicator">Saved!</div>
      </footer>
    </div>

    <!-- AFK Return Modal -->
    <div id="afk-modal" class="modal hidden">
      <div class="modal-content scroll-panel">
        <h2>Welcome Back, Cultivator!</h2>
        <p id="afk-time-away"></p>
        <div class="afk-gains">
          <div class="afk-gain">
            <span class="gain-label">PP Gained:</span>
            <span id="afk-pp-gained" class="gain-value">0</span>
          </div>
          <div class="afk-gain">
            <span class="gain-label">BP Gained:</span>
            <span id="afk-bp-gained" class="gain-value">0</span>
          </div>
        </div>
        <div id="afk-events" class="afk-events"></div>
        <button id="afk-close-btn" class="jade-button">Continue Cultivation</button>
      </div>
    </div>

    <!-- Goose Event Overlay -->
    <div id="goose-overlay" class="goose-overlay hidden">
      <div class="goose-alert">
        <h2>ğŸ¦¢ HONK! ğŸ¦¢</h2>
        <p>A wild Goose has appeared!</p>
      </div>
      <div id="goose-container" class="goose-container">
        <div id="goose-target" class="goose-target">ğŸ¦¢</div>
      </div>
      <div class="goose-timer">
        <div id="goose-timer-bar" class="goose-timer-bar"></div>
      </div>
      <p id="goose-mood" class="goose-mood">Mood: Calm</p>
    </div>

    <!-- Golden Snoot Overlay -->
    <div id="golden-snoot-container" class="golden-snoot-container hidden">
      <div id="golden-snoot" class="golden-snoot">
        <span class="golden-snoot-emoji">ğŸ‘ƒ</span>
        <span class="golden-snoot-glow"></span>
      </div>
      <div class="golden-snoot-timer">
        <div id="golden-snoot-timer-bar" class="golden-timer-bar"></div>
      </div>
    </div>

    <!-- Parasite Container -->
    <div id="parasite-container" class="parasite-container"></div>

    <!-- Blessing Selection Modal -->
    <div id="blessing-modal" class="modal hidden">
      <div class="modal-content scroll-panel blessing-modal">
        <h2>Choose a Blessing</h2>
        <p class="blessing-subtitle">Select one to aid your journey</p>
        <div id="blessing-options" class="blessing-options"></div>
        <button id="skip-blessing" class="jade-button small">Skip</button>
      </div>
    </div>

    <!-- Level Up Modal (Wave Survival) -->
    <div id="levelup-modal" class="modal hidden">
      <div class="modal-content scroll-panel levelup-modal">
        <h2>Level Up!</h2>
        <p id="levelup-text">Choose an upgrade</p>
        <div id="levelup-options" class="levelup-options"></div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
      <div class="modal-content scroll-panel settings-modal">
        <h2 id="settings-title">âš™ï¸ Settings</h2>

        <div class="settings-section">
          <h3>ğŸ”Š Audio</h3>
          <div class="setting-row">
            <label for="sfx-toggle">Sound Effects</label>
            <button id="sfx-toggle" class="toggle-btn" aria-pressed="true" role="switch">ON</button>
          </div>
          <div class="setting-row">
            <label for="music-toggle">Music</label>
            <button id="music-toggle" class="toggle-btn" aria-pressed="true" role="switch">ON</button>
          </div>
          <div class="setting-row">
            <label for="volume-slider">Volume</label>
            <input type="range" id="volume-slider" min="0" max="100" value="70" class="volume-slider">
            <span id="volume-value">70%</span>
          </div>
        </div>

        <div class="settings-section">
          <h3>ğŸ¨ Visual</h3>
          <div class="setting-row">
            <label for="particles-toggle">Particles</label>
            <button id="particles-toggle" class="toggle-btn" aria-pressed="true" role="switch">ON</button>
          </div>
          <div class="setting-row">
            <label for="screenshake-toggle">Screen Shake</label>
            <button id="screenshake-toggle" class="toggle-btn" aria-pressed="true" role="switch">ON</button>
          </div>
        </div>

        <div class="settings-section">
          <h3>ğŸ’¾ Data</h3>
          <div class="setting-row">
            <button id="export-save-btn" class="jade-button small">Export Save</button>
            <button id="import-save-btn" class="jade-button small">Import Save</button>
          </div>
          <textarea id="save-code" class="save-code-input" placeholder="Paste save code here..." rows="3"></textarea>
        </div>

        <div class="settings-buttons">
          <button id="settings-close-btn" class="jade-button">Close</button>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="help-title">
      <div class="modal-content scroll-panel help-modal">
        <h2 id="help-title">â“ How to Play</h2>

        <div class="help-section">
          <h3>ğŸ± The Basics</h3>
          <p><strong>BOOP THE SNOOT!</strong> Click the big red button to boop cats and earn <span class="highlight">BP (Boop Points)</span>.</p>
          <p>Cats generate <span class="highlight">PP (Purr Power)</span> automatically over time - even when you're away!</p>
        </div>

        <div class="help-section">
          <h3>âš¡ Combos & Crits</h3>
          <p>Keep booping to build a <span class="highlight">combo</span> (up to 2x bonus at 100 combo).</p>
          <p>You have a chance for <span class="highlight">Critical Boops</span> that deal 10x damage!</p>
          <p>The combo resets after 4 seconds of not booping.</p>
        </div>

        <div class="help-section">
          <h3>ğŸ‘¤ Your Master</h3>
          <p>Each of the <span class="highlight">Seven Masters</span> has a unique passive ability:</p>
          <ul class="help-list">
            <li><strong>Gerald:</strong> +25% BP while calm</li>
            <li><strong>Rusty:</strong> Active ability - 5x boop speed burst</li>
            <li><strong>Steve:</strong> 2x offline PP generation</li>
            <li><strong>Andrew:</strong> +50% event discovery</li>
            <li><strong>Nik:</strong> +25% critical chance</li>
            <li><strong>Yuelin:</strong> +50% cat happiness</li>
            <li><strong>Scott:</strong> Multipliers never decay</li>
          </ul>
        </div>

        <div class="help-section">
          <h3>ğŸ¦¢ HONK!</h3>
          <p>Watch out for <span class="highlight">Geese</span>! They appear randomly and must be booped before they escape!</p>
          <p>Angrier geese give bigger rewards but are harder to hit.</p>
        </div>

        <div class="help-section">
          <h3>â˜¯ï¸ Prestige</h3>
          <p>Once you reach enough BP, you can <span class="highlight">Ascend</span> to reset progress but gain permanent multipliers!</p>
          <p>At Tier 3, you can switch masters once per day.</p>
        </div>

        <div class="help-section">
          <h3>âŒ¨ï¸ Keyboard Shortcuts</h3>
          <ul class="help-list">
            <li><strong>Space:</strong> Boop (also boops Geese)</li>
            <li><strong>Escape:</strong> Close modals</li>
          </ul>
        </div>

        <div class="settings-buttons">
          <button id="help-close-btn" class="jade-button">Got it!</button>
        </div>
      </div>
    </div>

    <!-- Codex Modal -->
    <div id="codex-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="codex-title">
      <div class="modal-content scroll-panel codex-modal">
        <h2 id="codex-title">ğŸ“œ Celestial Codex</h2>
        <p class="codex-subtitle">Secrets of the Snoot Sect</p>

        <div class="codex-tabs">
          <button class="codex-tab active" data-codex="masters">ğŸ‘¤ Masters</button>
          <button class="codex-tab" data-codex="waifus">ğŸ’• Waifus</button>
          <button class="codex-tab" data-codex="cats">ğŸ± Cats</button>
          <button class="codex-tab" data-codex="geese">ğŸ¦¢ Geese</button>
        </div>

        <div id="codex-content" class="codex-content">
          <!-- Content populated by JS -->
        </div>

        <div class="settings-buttons">
          <button id="codex-close-btn" class="jade-button">Close</button>
        </div>
      </div>
    </div>

    <!-- Waifu Modal -->
    <div id="waifu-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="waifu-modal-title">
      <div class="modal-content scroll-panel waifu-modal-content">
        <h2 id="waifu-modal-title">ğŸ’• Waifu Masters</h2>

        <div class="waifu-modal-tabs">
          <button class="waifu-tab active" data-waifu-tab="collection">All Waifus</button>
          <button class="waifu-tab" data-waifu-tab="activities">Activities</button>
          <button class="waifu-tab" data-waifu-tab="schools">Schools</button>
          <button class="waifu-tab" data-waifu-tab="gifts">Gift Shop</button>
          <button class="waifu-tab" data-waifu-tab="inventory">My Gifts</button>
        </div>

        <!-- Waifus Collection Tab -->
        <div id="waifu-collection-tab" class="waifu-tab-content active">
          <div id="waifu-grid" class="waifu-grid">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Activities Tab -->
        <div id="waifu-activities-tab" class="waifu-tab-content">
          <!-- Current Activity Display -->
          <div id="current-activity" class="current-activity hidden">
            <div class="activity-progress-panel">
              <div class="activity-header">
                <span id="activity-emoji" class="activity-emoji">ğŸµ</span>
                <div class="activity-info">
                  <h4 id="activity-name">Tea Ceremony</h4>
                  <p id="activity-with">with <span id="activity-waifu-name">Mochi-chan</span></p>
                </div>
              </div>
              <div class="activity-progress-bar">
                <div id="activity-progress-fill" class="activity-progress-fill" style="width: 0%"></div>
              </div>
              <div class="activity-time">
                <span id="activity-time-remaining">5:00</span> remaining
              </div>
              <p id="activity-dialogue" class="activity-dialogue">"The tea is ready..."</p>
              <div class="activity-actions">
                <button id="complete-activity-btn" class="jade-button" disabled>Complete Activity</button>
                <button id="cancel-activity-btn" class="jade-button small danger">Cancel</button>
              </div>
            </div>
          </div>

          <!-- Activity Selection -->
          <div id="activity-selection" class="activity-selection">
            <div class="activity-waifu-select">
              <label for="activity-waifu-dropdown">Select Waifu:</label>
              <select id="activity-waifu-dropdown" class="activity-dropdown">
                <!-- Populated by JS -->
              </select>
            </div>

            <div id="available-activities" class="available-activities">
              <p class="empty-message">Select a waifu to see available activities.</p>
            </div>
          </div>

          <!-- Activity History -->
          <div class="activity-history-section">
            <h5 class="activity-history-header">Recent Activities</h5>
            <div id="activity-history" class="activity-history">
              <p class="empty-message">No activities completed yet.</p>
            </div>
          </div>
        </div>

        <!-- Gift Shop Tab -->
        <div id="waifu-gifts-tab" class="waifu-tab-content">
          <p class="gift-shop-intro">Purchase gifts to give to your waifus and increase bond!</p>
          <div id="gift-shop" class="gift-shop-grid">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Gift Inventory Tab -->
        <div id="waifu-inventory-tab" class="waifu-tab-content">
          <p class="gift-inventory-intro">Select a gift to give to your active waifu.</p>
          <div id="gift-inventory" class="gift-inventory-grid">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Selected Waifu Detail -->
        <div id="waifu-detail" class="waifu-detail hidden">
          <div class="waifu-detail-header">
            <div id="waifu-detail-portrait" class="waifu-detail-portrait">ğŸ¡</div>
            <div class="waifu-detail-info">
              <h3 id="waifu-detail-name">Mochi-chan</h3>
              <p id="waifu-detail-title" class="waifu-detail-title">The Welcoming Dawn</p>
              <div class="bond-bar large">
                <div id="waifu-detail-bond-fill" class="bond-fill" style="width: 0%"></div>
              </div>
              <p class="bond-label">Bond: <span id="waifu-detail-bond">0</span>/100</p>
            </div>
          </div>
          <p id="waifu-detail-dialogue" class="waifu-detail-dialogue">"Welcome~"</p>
          <div id="waifu-detail-bonus" class="waifu-detail-bonus"></div>
          <div class="waifu-detail-actions">
            <button id="set-active-waifu-btn" class="jade-button small">Set as Active</button>
            <button id="give-gift-btn" class="jade-button small">Give Gift</button>
          </div>
        </div>

        <div class="settings-buttons">
          <button id="waifu-modal-close" class="jade-button">Close</button>
        </div>
      </div>
    </div>

    <!-- Social Modal -->
    <div id="social-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="social-title">
      <div class="modal-content scroll-panel social-modal">
        <h2 id="social-title">ğŸ† Celestial Snoot Sect</h2>
        <p class="social-subtitle">Share your glory with the Seven Masters!</p>

        <!-- Social Tabs -->
        <div class="social-tabs">
          <button class="social-tab active" data-social-tab="card">ğŸ“œ Sect Card</button>
          <button class="social-tab" data-social-tab="leaderboard">ğŸ… Leaderboard</button>
          <button class="social-tab" data-social-tab="saves">ğŸ’¾ Save Sharing</button>
        </div>

        <!-- Sect Card Tab -->
        <div id="social-card-tab" class="social-tab-content active">
          <div class="sect-card-preview">
            <div class="sect-card-header">
              <div class="sect-card-portrait">
                <span id="card-master-emoji">ğŸ‰</span>
              </div>
              <div class="sect-card-info">
                <h3 id="card-master-name" class="sect-card-name">Master Name</h3>
                <p id="card-master-title" class="sect-card-title">Title</p>
              </div>
            </div>

            <div class="sect-card-stats">
              <div class="sect-stat">
                <span class="sect-stat-label">Total Boops</span>
                <span id="card-stat-boops" class="sect-stat-value">0</span>
              </div>
              <div class="sect-stat">
                <span class="sect-stat-label">Cats</span>
                <span id="card-stat-cats" class="sect-stat-value">0</span>
              </div>
              <div class="sect-stat">
                <span class="sect-stat-label">Highest Realm</span>
                <span id="card-stat-realm" class="sect-stat-value">None</span>
              </div>
              <div class="sect-stat">
                <span class="sect-stat-label">Total Bonds</span>
                <span id="card-stat-bonds" class="sect-stat-value pink">0</span>
              </div>
              <div class="sect-stat">
                <span class="sect-stat-label">Favorite Waifu</span>
                <span id="card-stat-waifu" class="sect-stat-value pink">None</span>
              </div>
              <div class="sect-stat">
                <span class="sect-stat-label">Max Combo</span>
                <span id="card-stat-combo" class="sect-stat-value">0x</span>
              </div>
              <div class="sect-stat">
                <span class="sect-stat-label">Geese Booped</span>
                <span id="card-stat-goose" class="sect-stat-value gold">0</span>
              </div>
              <div class="sect-stat">
                <span class="sect-stat-label">Achievements</span>
                <span id="card-achievement-progress" class="sect-stat-value">0/0</span>
              </div>
            </div>

            <div class="sect-card-footer">
              <p style="font-size: 7px; color: #666; margin-bottom: 5px;">Latest Achievement:</p>
              <p id="card-latest-achievement" style="font-size: 9px; color: var(--gold-accent);">None yet</p>
              <div class="power-score">
                <span class="power-score-label">Power Score:</span>
                <span id="card-stat-power" class="power-score-value">0</span>
              </div>
            </div>
          </div>

          <div class="card-actions">
            <button id="copy-sect-card" class="jade-button small">ğŸ“‹ Copy Full Card</button>
            <button id="copy-compact-card" class="jade-button small">ğŸ“ Copy Compact</button>
          </div>

          <!-- The Seven Masters -->
          <div class="master-badges">
            <div class="master-badge-mini" data-master="gerald" style="--master-color: #50C878;">
              <span class="badge-emoji">ğŸ‰</span>
              <span class="badge-name">Gerald</span>
            </div>
            <div class="master-badge-mini" data-master="rusty" style="--master-color: #DC143C;">
              <span class="badge-emoji">ğŸ‘Š</span>
              <span class="badge-name">Rusty</span>
            </div>
            <div class="master-badge-mini" data-master="steve" style="--master-color: #4169E1;">
              <span class="badge-emoji">ğŸŒŠ</span>
              <span class="badge-name">Steve</span>
            </div>
            <div class="master-badge-mini" data-master="andrew" style="--master-color: #FFD700;">
              <span class="badge-emoji">âš¡</span>
              <span class="badge-name">Andrew</span>
            </div>
            <div class="master-badge-mini" data-master="nik" style="--master-color: #483D8B;">
              <span class="badge-emoji">ğŸŒ™</span>
              <span class="badge-name">Nik</span>
            </div>
            <div class="master-badge-mini" data-master="yuelin" style="--master-color: #FFB6C1;">
              <span class="badge-emoji">ğŸª·</span>
              <span class="badge-name">Yuelin</span>
            </div>
            <div class="master-badge-mini" data-master="scott" style="--master-color: #8B4513;">
              <span class="badge-emoji">â›°ï¸</span>
              <span class="badge-name">Scott</span>
            </div>
          </div>
        </div>

        <!-- Leaderboard Tab -->
        <div id="social-leaderboard-tab" class="social-tab-content">
          <div class="leaderboard-controls">
            <select id="leaderboard-category" class="leaderboard-select">
              <option value="power">âš¡ Power Score</option>
              <option value="boops">ğŸ‘† Total Boops</option>
              <option value="cats">ğŸ± Cats Recruited</option>
              <option value="bonds">ğŸ’• Total Bonds</option>
              <option value="goose">ğŸ¦¢ Geese Booped</option>
              <option value="combo">ğŸ”¥ Max Combo</option>
              <option value="achievements">ğŸ† Achievements</option>
            </select>
          </div>

          <div id="leaderboard-entries" class="leaderboard-entries">
            <p class="empty-message">No entries yet! Submit your score to be first!</p>
          </div>

          <div class="leaderboard-actions">
            <button id="submit-score-btn" class="jade-button small">ğŸ“¤ Submit Score</button>
            <button id="export-leaderboard-btn" class="jade-button small">ğŸ’¾ Export</button>
            <button id="import-leaderboard-btn" class="jade-button small">ğŸ“¥ Import</button>
          </div>

          <textarea id="leaderboard-code" class="leaderboard-code" rows="2" placeholder="Paste leaderboard code here to import..."></textarea>
        </div>

        <!-- Save Sharing Tab -->
        <div id="social-saves-tab" class="social-tab-content">
          <div class="save-sharing-section">
            <h4>ğŸ“¤ Export Your Save</h4>
            <p style="font-size: 8px; color: #888; margin-bottom: 10px;">Share your progress with friends or backup your save.</p>
            <div class="save-actions">
              <button id="export-social-save" class="jade-button small">Export Save</button>
            </div>
          </div>

          <div class="save-sharing-section">
            <h4>ğŸ“¥ Import Save</h4>
            <p style="font-size: 8px; color: #888; margin-bottom: 10px;">Paste a save code below to preview and import.</p>
            <textarea id="social-save-code" class="social-save-code" rows="3" placeholder="Paste save code here..."></textarea>
            <div class="save-actions" style="margin-top: 10px;">
              <button id="preview-import" class="jade-button small">Preview</button>
              <button id="confirm-import" class="jade-button small hidden">Confirm Import</button>
            </div>
            <div id="import-preview" class="import-preview"></div>
          </div>
        </div>

        <div class="settings-buttons">
          <button id="social-modal-close" class="jade-button">Close</button>
        </div>
      </div>
    </div>

    <!-- Active Effects Display -->
    <div id="active-effects" class="active-effects"></div>

    <!-- Status Widgets Container (bottom-left) -->
    <div class="status-widgets">
      <!-- IRL Time Bonus Display -->
      <div id="irl-bonus" class="irl-bonus">
        <span id="irl-time-icon" class="irl-icon">â˜€ï¸</span>
        <span id="irl-time-name" class="irl-name">Morning</span>
        <span id="irl-time-bonus" class="irl-bonus-text">+10% BP</span>
      </div>

      <!-- Daily Commissions Panel -->
      <div id="daily-panel" class="daily-panel">
        <div class="daily-header" onclick="toggleDailyPanel()">
          <span>ğŸ“‹</span>
          <span id="daily-progress">0/4</span>
        </div>
        <div id="daily-content" class="daily-content hidden">
          <h4>Daily Commissions</h4>
          <div id="daily-streak" class="daily-streak">
            Streak: <span id="streak-count">0</span> days
          </div>
          <div id="daily-list" class="daily-list"></div>
          <button id="claim-all-daily" class="jade-button small">Claim All</button>
        </div>
      </div>

      <!-- Drama Meter -->
      <div id="drama-meter" class="drama-meter">
        <div class="drama-header" onclick="toggleDramaPanel()">
          <span>ğŸ­</span>
          <span id="drama-level">0</span>
        </div>
        <div id="drama-content" class="drama-content hidden">
          <h4>Drama Level</h4>
          <div class="drama-bar">
            <div id="drama-fill" class="drama-fill" style="width: 0%"></div>
          </div>
          <p id="drama-status">All is peaceful...</p>
          <div id="drama-events" class="drama-events"></div>
        </div>
      </div>
    </div>

    <!-- Hardcore Mode Indicator -->
    <div id="hardcore-indicator" class="hardcore-indicator hidden">
      <span id="hardcore-icon">ğŸ’€</span>
      <span id="hardcore-name">Ironman Mode</span>
      <span id="hardcore-timer"></span>
    </div>

    <!-- Nemesis Warning -->
    <div id="nemesis-warning" class="nemesis-warning hidden">
      <div class="nemesis-alert">
        <h3 id="nemesis-title">ğŸ’€ NEMESIS APPROACHES ğŸ’€</h3>
        <p id="nemesis-taunt">"I've been waiting..."</p>
      </div>
    </div>

    <!-- Mobile Navigation Bar -->
    <nav id="mobile-nav" class="mobile-nav" aria-label="Main navigation">
      <button class="mobile-nav-btn active" data-tab="cats" aria-label="Cats tab">
        <span class="nav-icon">ğŸ±</span>
        <span class="nav-label">Cats</span>
      </button>
      <button class="mobile-nav-btn" data-tab="upgrades" aria-label="Upgrades tab">
        <span class="nav-icon">âš”ï¸</span>
        <span class="nav-label">Arts</span>
      </button>
      <button class="mobile-nav-btn" data-tab="pagoda" aria-label="Pagoda tab">
        <span class="nav-icon">ğŸ¯</span>
        <span class="nav-label">Pagoda</span>
      </button>
      <button class="mobile-nav-btn" data-tab="expeditions" aria-label="Expeditions tab">
        <span class="nav-icon">ğŸ—ºï¸</span>
        <span class="nav-label">Quest</span>
      </button>
      <button class="mobile-nav-btn" data-tab="more" aria-label="More options">
        <span class="nav-icon">â˜°</span>
        <span class="nav-label">More</span>
      </button>
    </nav>

    <!-- Mobile Tab Modal -->
    <div id="mobile-tab-modal" class="mobile-tab-modal hidden" role="dialog" aria-modal="true">
      <div class="mobile-tab-header">
        <h3 id="mobile-tab-title">Tab</h3>
        <button id="mobile-tab-close" class="mobile-tab-close" aria-label="Close">&times;</button>
      </div>
      <div id="mobile-tab-content" class="mobile-tab-content">
        <!-- Tab content cloned here on mobile -->
      </div>
    </div>

    <!-- Mobile More Menu -->
    <div id="mobile-more-menu" class="mobile-more-menu hidden">
      <button class="more-menu-btn" data-tab="equipment">âš™ï¸ Equipment</button>
      <button class="more-menu-btn" data-tab="forge">ğŸ”¨ Forge</button>
      <button class="more-menu-btn" data-tab="catino">ğŸ° Casino</button>
      <button class="more-menu-btn" data-tab="partners">ğŸ’• Partners</button>
      <button class="more-menu-btn" data-tab="shop">ğŸ¦… Shop</button>
      <button class="more-menu-btn" data-tab="facilities">â˜¯ï¸ Sect</button>
      <button class="more-menu-btn" data-tab="techniques">ğŸ“œ Skills</button>
      <button class="more-menu-btn" data-tab="stats">ğŸ“Š Stats</button>
      <button class="more-menu-btn" data-tab="waifu">ğŸ’ Waifu</button>
    </div>
  </div>

  <!-- Scripts -->
  <!-- Core Utilities (load first) -->
  <script src="js/core/dataLoader.js"></script>
  <!-- UI/UX Systems (load first for availability) -->
  <script src="js/particles.js"></script>
  <script src="js/notifications.js"></script>
  <!-- Core Systems -->
  <script src="js/masters.js"></script>
  <script src="js/cats.js"></script>
  <script src="js/waifus.js"></script>
  <script src="js/activity-ui.js"></script>
  <script src="js/upgrades.js"></script>
  <script src="js/events.js"></script>
  <script src="js/achievements.js"></script>
  <script src="js/goose.js"></script>
  <script src="js/gifts.js"></script>
  <script src="js/expeditions.js"></script>
  <script src="js/minigame.js"></script>
  <script src="js/prestige.js"></script>
  <script src="js/audio.js"></script>
  <script src="js/buildings.js"></script>
  <script src="js/economy.js"></script>
  <!-- Phase 3 Systems -->
  <script src="js/elements.js"></script>
  <script src="js/equipment.js"></script>
  <script src="js/systems/relics.js"></script>
  <script src="js/crafting.js"></script>
  <script src="js/techniques.js"></script>
  <script src="js/pagoda.js"></script>
  <script src="js/blessings.js"></script>
  <script src="js/wave-survival.js"></script>
  <script src="js/golden-snoot.js"></script>
  <script src="js/daily.js"></script>
  <script src="js/parasites.js"></script>
  <!-- POST-LAUNCH Systems -->
  <script src="js/irl-integration.js"></script>
  <script src="js/drama.js"></script>
  <script src="js/nemesis.js"></script>
  <script src="js/catino.js"></script>
  <script src="js/hardcore.js"></script>
  <script src="js/partner-generator.js"></script>
  <script src="js/cultivation.js"></script>
  <!-- Time & Events System -->
  <script src="js/time.js"></script>
  <!-- Social Features -->
  <script src="js/social.js"></script>
  <script src="js/save.js"></script>
  <script src="js/game.js"></script>
</body>
</html>
